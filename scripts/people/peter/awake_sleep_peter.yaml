# Script - When Peter is going to bed
peter_tobed:
  alias: '[Huis] - Peter naar bed'
  sequence:
  - data:
      entity_id: input_boolean.peter_inbed
    service: input_boolean.turn_on
  - service_template: >-
        {% if is_state('media_player.3c36e4_eosstb_003766202901','playing') or is_state('media_player.kodi_woonkamer','playing') %}
          notify.mobile_app_iphone_van_peter
        {% elif as_timestamp(now()) - states.input_boolean.sharona_inbed.last_changed | as_timestamp  > 5400 %}
          script.bedroom_watch_tvshow_kodi
        {% else %}
          script.dummy
        {% endif %}
    data_template:
      title: 'Welterusten!'
      message: >-
        {% if is_state('media_player.3c36e4_eosstb_003766202901','playing') %}
          "Wil je {{state_attr('media_player.3c36e4_eosstb_003766202901','media_series_title')}} op {{state_attr('media_player.3c36e4_eosstb_003766202901','media_title')}} verder kijken in de slaapkamer?"
        {% elif is_state('media_player.kodi_woonkamer','playing') and is_state_attr('media_player.kodi_woonkamer','media_content_type','tvshow') %}
          "Wil je de aflevering {{state_attr('media_player.kodi_woonkamer','media_title')}} van {{state_attr('media_player.kodi_woonkamer','media_series_title')}} verder kijken in de slaapkamer?"
        {% elif is_state('media_player.kodi_woonkamer','playing') and is_state_attr('media_player.kodi_woonkamer','media_content_type','movie') %}
          "Wil je de film {{state_attr('media_player.kodi_woonkamer','media_title')}} verder kijken in de slaapkamer?"
        {% else %}
          "Slaap lekker"
        {% endif %}
      data:
        push:
          category: "continue_watching"
  - service_template: >-
        {% if is_state('input_boolean.sharona_inbed','on') %}
          script.lights_tobed_all
        {% else %}
          script.lights_tobed_single
        {% endif %}
  - service_template: >-
        {% if (is_state('input_boolean.sharona_inbed','on') or (states('person.sharona') != 'home')) and is_state('media_player.woonkamer','playing') %}
          media_player.media_stop
        {% else %}
          script.dummy
        {% endif %}
    data:
      entity_id: media_player.woonkamer
  - wait_template: "{{is_state('binary_sensor.0x00158d0004142172_occupancy','on')}}"
  - data_template:
      group_name: Slaapkamer
      scene_name: >-
        {% if is_state('input_boolean.sharona_inbed','on') %}
          Gaan slapen Peter
        {% else %}
          Gaan slapen
        {% endif %}
    service: hue.hue_activate_scene
  - condition: and
    conditions:
      - condition: state
        entity_id: input_boolean.sharona_inbed
        state: 'off'
      - condition: template
        value_template: "{{ (states('person.sharona') != 'home') }}"
  - service: scene.turn_on
    data:
      entity_id: scene.woonkamer_gedimd

#Script - Peter wakes up
peter_awake:
  alias: '[Huis] - Peter is wakker'
  sequence:
  - data:
      entity_id: input_boolean.peter_inbed
    service: input_boolean.turn_off
  - service: notify.mobile_app_iphone_van_peter
    data:
      title: 'Goedemorgen Peter'
      message: 'Hoe wil je wakker worden?'
      data:
        push:
          category: "peter_awake"
  - wait_template: "{{ is_state('sensor.peter_room_presence','Woonkamer') }}"
    timeout: "00:30:00"
    continue_on_timeout: false
  - service: media_player.volume_set
    data:
      entity_id: media_player.woonkamer_2
      volume_level: 0.5
  - service: tts.google_cloud_say
    data_template:
      message: "Goedemorgen Peter, het is {{states('sensor.time')}}, de temperatuur is {{state_attr('weather.huis','temperature')}} graden en de huidige reistijd naar jouw werk is: {{states('sensor.reistijd_peter_werk')}} minuten."
      entity_id: media_player.woonkamer_2
